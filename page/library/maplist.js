mapsData = [
    {
        id: ["eenot", "world", "v1"],
        title: "World by ЕЕнот",
        author: ["eenot"],
        description: "The best world map for normal and low devices. Very optimized. By developer of EEditor",
        type: "world",
        region: ["europe", "north_africa", "middle_east", "asia", "americas", "africa", "oceania"],
        provinces: 1147,
        features: ["water_provinces", "islands", "straits", "rivers", "shores"],
        status: "completed",
        publishDate: "2025-01-19",
        lastUpdate: "2025-01-19",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["eenot", "moldavia", "v1"],
        title: "Moldavia by ЕЕнот",
        author: ["eenot"],
        description: "Map of Republic of Moldova, Pridnestrovian Moldavian Rupublic and Odesska Oblast of Ukraine",
        type: "country",
        region: ["europe"],
        provinces: 1147,
        features: ["rivers", "shores"],
        status: "completed",
        publishDate: "2025-04-28",
        lastUpdate: "2025-04-28",
        load: "ultralight",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["bluepum", "enaatme", "v5"],
        title: "Europe+ by Bluepum",
        author: ["bluepum"],
        description: "Map of Europe, North Africa and Middle East",
        type: "continent",
        region: ["europe", "north_africa", "middle_east"],
        provinces: 734,
        features: ["water_provinces", "islands"],
        status: "in_development",
        publishDate: "2025-04-26",
        lastUpdate: "2025-05-14",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["bluepum", "germany", "v1"],
        title: "Germany by Bluepum",
        author: ["bluepum"],
        description: "This is the administrative division of Germany",
        type: "country",
        region: ["europe"],
        provinces: 412,
        features: [],
        status: "completed",
        publishDate: "2025-04-24",
        lastUpdate: "2025-04-24",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["eenot", "arstotzka", "v2"],
        title: "Arstotzka World by ЕЕнот",
        author: ["eenot"],
        description: "Unofficial world map of Paper's Please world",
        type: "world",
        region: ["other"],
        provinces: 373,
        features: ["rivers", "shores", "water_provinces"],
        status: "completed",
        publishDate: "2025-04-21",
        lastUpdate: "2025-04-21",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "world-3ga", "v1"],
        title: "World 3b years ago by Zachary",
        author: ["zachary"],
        description: "Unofficial world map of Paper's Please world",
        type: "world",
        region: ["other"],
        provinces: 130,
        features: ["water_provinces"],
        status: "completed",
        publishDate: "2025-04-09",
        lastUpdate: "2025-04-09",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "authun", "v1"],
        title: "Austria-Hungaria by Zachary",
        author: ["zachary"],
        description: "Map of Austro-Hungarian Empire",
        type: "region",
        region: ["europe","balkans"],
        provinces: 1644,
        features: [],
        status: "completed",
        publishDate: "2025-01-31", 
        lastUpdate: "2025-01-31",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "world-am", "v1"],
        title: "World according to America",
        author: ["zachary"],
        description: "World according to America",
        type: "world",
        region: ["europe","asia", "africa", "oceania", "america"],
        provinces: 665,
        features: [],
        status: "completed",
        publishDate: "2025-01-28", 
        lastUpdate: "2025-01-28",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "panem", "v2"],
        title: "Panem v2 by Zachary",
        author: ["zachary"],
        description: "Map of Panem from Hunger Games",
        type: "country",
        region: ["america"],
        provinces: 358,
        features: [],
        status: "completed",
        publishDate: "2025-01-27", 
        lastUpdate: "2025-01-27",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "eurasia", "v2"],
        title: "Terra Eurasia by Zachary",
        author: ["zachary"],
        description: "Big detalized map of Eurasia",
        type: "continent",
        region: ["europe", "asia", "north_africa"],
        provinces: 4587,
        features: [],
        status: "completed",
        publishDate: "2024-11-29", 
        lastUpdate: "2024-11-29",
        load: "superheavy",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "mars", "v1"],
        title: "Terraformed Mars by Zachary",
        author: ["zachary"],
        description: "Map of Mars with terraformed areas",
        type: "world",
        region: ["other"],
        provinces: 438,
        features: [],
        status: "completed",
        publishDate: "2025-01-20", 
        lastUpdate: "2025-01-20",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "florida", "v1"],
        title: "Florida by Zachary",
        author: ["zachary"],
        description: "Florida",
        type: "oblast",
        region: ["america"],
        provinces: 159,
        features: [],
        status: "completed",
        publishDate: "2024-10-31", 
        lastUpdate: "2024-10-31",
        load: "ultralight",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "africa", "v3"],
        title: "Terra Africa by Zachary",
        author: ["zachary"],
        description: "Welcome to Terra Africa! This map was built to be as big as possible which is why its my new highest province map",
        type: "continent",
        region: ["africa", "middle_east", "mediterranean"],
        provinces: 1031,
        features: [],
        status: "completed",
        publishDate: "2024-10-16", 
        lastUpdate: "2024-10-29",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "australia", "v1"],
        title: "Terra Australis by Zachary",
        author: ["zachary"],
        description: "I guess i decided that my maps should follow a naming convention so... After Terra Novus we have Terra Australis! This is a map of south east Asia and Oceania!",
        type: "continent",
        region: ["australia", "oceania", "south_east_asia"],
        provinces: 668,
        features: [],
        status: "completed",
        publishDate: "2024-10-07", 
        lastUpdate: "2024-10-07",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "america", "v2"],
        title: "Terra Novus by Zachary",
        author: ["zachary"],
        description: "This is meine magnum opus, the Americas! This is a remake of my previous map called the Americas, this one has 2x the detail and better provinces that allow more historical boundaries.",
        type: "continent",
        region: ["americas", "north_america", "south_america", "central_america"],
        provinces: 1822,
        features: [],
        status: "completed",
        publishDate: "2024-08-22", 
        lastUpdate: "2024-10-07",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "europe1815", "v2"],
        title: "Europe 1815 by Zachary",
        author: ["zachary"],
        description: "Thankfully the German Confederation has much less chaos then the Holy Roman Empire. I hope its accurate.",
        type: "continent",
        region: ["europe"],
        provinces: 0,
        features: [],
        status: "completed",
        publishDate: "2024-07-26", 
        lastUpdate: "2024-07-26",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "usa", "v1"],
        title: "USA by Zachary",
        author: ["zachary"],
        description: "Three maps in 3 days.",
        type: "country",
        region: ["north_america"],
        provinces: 286,
        features: [],
        status: "completed",
        publishDate: "2025-01-21", 
        lastUpdate: "2025-01-21",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "deadhand", "v1"],
        title: "Dead Hand | Aftermath of WW3",
        author: ["zachary"],
        description: "The year is 2024, 60 years after nuclear bombs were detonated in WW3! Explore the post nuclear 'paradise' that has everything from Soviet warlords to Khagantes all in the good old USA, this has events and tons of lore.",
        type: "region",
        region: ["north_america"],
        provinces: 1086,
        features: [],
        status: "completed",
        publishDate: "2025-05-07", 
        lastUpdate: "2025-05-07",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["pelo", "greece", "v1"],
        title: "Aegean Sea by Pelo",
        author: ["pelo"],
        description: "Thankfully the German Confederation has much less chaos then the Holy Roman Empire. I hope its accurate.",
        type: "country",
        region: ["europe"],
        provinces: 311,
        features: [],
        status: "completed",
        publishDate: "2024-07-26", 
        lastUpdate: "2024-07-26",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["jaba", "america", "vg"],
        title: "America standart",
        author: ["jaba"],
        description: "Standart map of America",
        type: "continent",
        region: ["america", "north_america", "south_america", "central_america"],
        provinces: 430,
        features: [],
        status: "completed",
        publishDate: "2023-08-12", 
        lastUpdate: "2023-08-19",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["parkourcat", "euro4", "vg"],
        title: "Euro4 standart",
        author: ["parkourcat"],
        description: "Standart map of America",
        type: "continent",
        region: ["europe", "north_africa", "middle_east"],
        provinces: 430,
        features: [],
        status: "completed",
        publishDate: "2023-08-05", 
        lastUpdate: "2023-08-05",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["zachary", "world", "v1"],
        title: "World by Zachary",
        author: ["zachary"],
        description: "One of the bestest world maps",
        type: "world",
        region: ["water_provinces", "islands", "straits", "rivers", "shores"],
        provinces: 2871,
        features: ["water_provinces", "islands", "straits", "rivers"],
        status: "completed",
        publishDate: "2025-02-10", 
        lastUpdate: "2025-02-10",
        load: "normal",
        hiddenScore: 150,
        rights: true
    },
    {
        id: ["jalhund", "europe", "vg"],
        title: "Europe Standart",
        author: ["jalhund"],
        description: "Builded-in map of Europe by game developer",
        type: "continent",
        region: ["europe"],
        provinces: 293,
        features: ["water_provinces", "islands"],
        status: "completed",
        publishDate: "1912-04-15",
        lastUpdate: "2077-01-01",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["stewardconstruct", "europe", "v2"],
        title: "Europe (Our Empire)",
        author: ["stewardconstruct"],
        description: "A map of Europe, north Africa and middle east, province map from game our empire with minor changes",
        type: "region",
        region: ["europe", "north_africa", "middle_east"],
        provinces: 619,
        features: [],
        status: "completed",
        publishDate: "2025-05-05", 
        lastUpdate: "2025-06-04",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["stewardconstruct", "serbia", "v1"],
        title: "Serbia",
        author: ["stewardconstruct"],
        description: "",
        type: "country",
        region: ["europe", "balcans"],
        provinces: 268,
        features: [],
        status: "completed",
        publishDate: "2025-03-15", 
        lastUpdate: "2025-03-15",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["stewardconstruct", "yugoslavia", "v1"],
        title: "Yugoslavia",
        author: ["stewardconstruct"],
        description: "",
        type: "region",
        region: ["europe", "balcans"],
        provinces: 604,
        features: [],
        status: "completed",
        publishDate: "2025-03-19", 
        lastUpdate: "2025-03-19",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["trid", "archangelsk", "v1"],
        title: "Archangelsk",
        author: ["trid"],
        description: "",
        type: "oblast",
        region: ["europe", "russia"],
        provinces: 75,
        features: [],
        status: "completed",
        publishDate: "2024-02-04", 
        lastUpdate: "2024-02-04",
        load: "ultralight",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["chuckcha", "europe", "v1"],
        title: "Crusader Kings 3 Europe, Africa and Middle East",
        author: ["chuckcha"],
        description: "",
        type: "continent",
        region: ["europe", "africa", "middle_east"],
        provinces: 1810,
        features: [],
        status: "completed",
        publishDate: "2023-01-29", 
        lastUpdate: "2023-01-29",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["jalhund", "euro5l", "v1"],
        title: "Euro5 Lite by jalhund",
        author: ["jalhund"],
        description: "",
        type: "continent",
        region: ["europe", "africa", "middle_east"],
        provinces: 880,
        features: [],
        status: "completed",
        publishDate: "2024-03-16", 
        lastUpdate: "2024-03-16",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["jaba", "asia", "v1"],
        title: "Asia and Oceania EU4",
        author: ["jaba"],
        description: "",
        type: "continent",
        region: ["middle_east", "asia", "oceania"],
        provinces: 1352,
        features: [],
        status: "completed",
        publishDate: "2024-02-20", 
        lastUpdate: "2024-02-20",
        load: "normal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["jaba", "world", "v1"],
        title: "World EU4 by Jaba",
        author: ["jaba"],
        description: "",
        type: "world",
        region: ["middle_east", "asia", "europe", "north_africa", "americas", "africa", "oceania", "world"],
        provinces: 3553,
        features: [],
        status: "completed",
        publishDate: "2024-04-03", 
        lastUpdate: "2024-04-03",
        load: "superheavy",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["jalhund", "lp16", "v1"],
        title: "LP-16 by Jalhund",
        author: ["jalhund"],
        description: "",
        type: "custom",
        region: ["other"],
        provinces: 269,
        features: [],
        status: "completed",
        publishDate: "2023-06-12", 
        lastUpdate: "2023-06-12",
        load: "ultralight",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["trid", "eurosat", "v5"],
        title: "EuroSat by Trid",
        author: ["trid"],
        description: "",
        type: "continent",
        region: ["europe", "africa", "middle_east"],
        provinces: 1160,
        features: [],
        status: "completed",
        publishDate: "2024-02-12", 
        lastUpdate: "2024-03-27",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["trid", "euro5l+", "v1"],
        title: "Euro5 Lite+ by Trid",
        author: ["trid"],
        description: "",
        type: "continent",
        region: ["europe", "africa", "middle_east"],
        provinces: 906,
        features: [],
        status: "completed",
        publishDate: "2024-07-22", 
        lastUpdate: "2024-07-22",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["jaba", "korea", "v2"],
        title: "Korea by Jaba",
        author: ["jaba"],
        description: "",
        type: "country",
        region: ["asia", "korea"],
        provinces: 69,
        features: [],
        status: "completed",
        publishDate: "2023-09-26", 
        lastUpdate: "2024-10-01",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["trid", "ukraine", "v2"],
        title: "Ukraine by Trid",
        author: ["trid"],
        description: "",
        type: "country",
        region: ["ukraine"],
        provinces: 641,
        features: [],
        status: "completed",
        publishDate: "2024-06-11", 
        lastUpdate: "2024-09-15",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["chuckcha", "tigerland", "v1"],
        title: "Tigerland by Chuckcha",
        author: ["chuckcha"],
        description: "",
        type: "country",
        region: ["alternative"],
        provinces: 910,
        features: [],
        status: "completed",
        publishDate: "2024-06-11", 
        lastUpdate: "2024-09-15",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["chuckcha", "tigerland", "v2"],
        title: "Tigerland v2",
        author: ["jalhund"],
        description: "",
        type: "country",
        region: ["alternative"],
        provinces: 929,
        features: [],
        status: "completed",
        publishDate: "2024-06-11", 
        lastUpdate: "2024-11-17",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["chuckcha", "tigerland", "v3"],
        title: "Tigerland v3",
        author: ["jalhund"],
        description: "",
        type: "country",
        region: ["alternative"],
        provinces: 929,
        features: [],
        status: "completed",
        publishDate: "2024-06-11", 
        lastUpdate: "2024-11-17",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["mapmancer", "centaura", "v1"],
        title: "Centaura by Mapmancer",
        author: ["mapmancer"],
        description: "",
        type: "continent",
        region: ["alternative"],
        provinces: 230,
        features: [],
        status: "completed",
        publishDate: "2025-04-13", 
        lastUpdate: "2025-04-13",
        load: "norlmal",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["bluepum", "world", "v2"],
        title: "Easy World by Bluepum",
        author: ["bluepum"],
        description: "World with «lost» continents",
        type: "world",
        region: ["world", "europe", "north_africa", "middle_east", "asia", "americas", "africa", "oceania", "atlantida", "mu", "lemuria", "antarctica"],
        provinces: 426,
        features: [],
        status: "completed",
        publishDate: "2025-05-26", 
        lastUpdate: "2025-05-27",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["bluepum", "atlantis", "v2"],
        title: "Atlantis by Bluepum",
        author: ["bluepum"],
        description: "This is a map of the legendary mythical Atlantis!",
        type: "continent",
        region: ["atlantis", "atlantida", "other", "custom"],
        provinces: 277,
        features: [],
        status: "completed",
        publishDate: "2025-05-27", 
        lastUpdate: "2025-05-27",
        load: "light",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["pelo", "euam", "v1"],
        title: "Europe and North America",
        author: ["pelo", "jaba"],
        description: "",
        type: "continent",
        region: ["europe", "america", "north_america"],
        provinces: 1091,
        features: [],
        status: "completed",
        publishDate: "2025-06-02", 
        lastUpdate: "2025-06-23",
        load: "mobile",
        hiddenScore: 0,
        rights: true
    },
    {
        id: ["chitterss", "world", "v3"],
        title: "World by chitterss",
        author: ["chitterss"],
        description: "",
        type: "continent",
        region: ["europe", "america", "north_america", "asia", "africa", "oceania", "middle_east"],
        provinces: 1091,
        features: [],
        status: "completed",
        publishDate: "2023-07-25", 
        lastUpdate: "2023-07-30",
        load: "hight",
        hiddenScore: 0,
        rights: true
    },
];

const mapTypes = {
    "world": "World",
    "continent": "Continent",
    "region": "Region",
    "country": "Country",
    "oblast": "Oblast",
    "district": "Disctrict",
    "city": "City",
    "custom": "Custom"
};

const mapFeatures = {
    "water_provinces": "Water Provinces",
    "islands": "Islands",
    "straits": "Straits",
    "deserts": "Deserts",
    "rivers": "Rivers",
    "terrain": "Terrain",
    "resources": "Resources"
};

const mapRegions = {
    "world": "World",
    "europe": "Europe",
    "north_africa": "North Africa",
    "middle_east": "Middle East",
    "asia": "Asia",
    "americas": "Americas",
    "africa": "Africa",
    "oceania": "Oceania"
};

const mapLoads = {
    "ultralight": "Ultra Light",
    "mobile": "Mobile",
    "light": "Light",
    "normal": "Normal",
    "heavy": "Heavy",
    "superheavy": "Super Heavy"
};

function generateDetailsLinkMap(mapId) {
    return `details.html?type=map&map=${mapId}`;
}

// Функция для генерации HTML карточки карты
function generateMapCard(map) {
    const detailsLink = generateDetailsLinkMap(map.id.join('_'));
    const imagePath = `${libLink}lib/${map.id.slice(0, 2).join('/')}/${map.id.join('_')}_!.png`;
    const awardsHTML = ''; // Can be implemented later if needed
    const status = map.status || 'completed';
    const statusLabel = status.charAt(0).toUpperCase() + status.slice(1);
    let noRights;
    if (map.rights === true) {
        noRights = "";
    } else {
        noRights = `<button class="download-download-button" onclick="askDelete()" style="background-color: #945d44ff; border-radius: 15px; width: 45px; height: 45px; border: none; cursor: pointer;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"role="img" aria-label="Жалоба: предупреждение" focusable="false"><title>Жалоба</title><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                    </button>`;
    }

    return `
        <div class="download-card" 
            data-title="${map.title}"
            data-author="${authorsData[map.author]?.name}" 
            data-type="${map.type}" 
            data-map-id="${map.id.join('_')}" 
            data-publish-date="${map.publishDate}"
            data-last-update="${map.lastUpdate}"
            data-score="${map.hiddenScore}"
            data-provinces="${map.provinces}" 
            data-features="${map.features.join(',')}"
            data-regions="${map.region.join(',')}"
            data-load="${map.load}"
            data-status="${map.status}"
        >
            <div class="download-info">
                <div class="download-up">
                    <div class="download-image-container">
                        <a href="${detailsLink}">
                            <img src="${imagePath}" class="download-goto-page" style="width: 250px; height: 156px; object-fit: cover; border-radius: 15px 15px 0 0;">
                        </a>
                        <div class="download-awards">
                            ${awardsHTML}
                        </div>
                        <div class="download-status status-${status}">
                            ${statusLabel}
                        </div>
                    </div>
                </div>
                <div class="download-center">
                    <a href="${detailsLink}" class="download-title download-goto-page" target="_blank">${map.title}</a>
                    <div class="download-row-big">
                        <div class="download-row">
                            <img src="../../img/library/autor.svg" class="download-info-ico" />
                            <div class="authors" style="display:flex; flex-direction:column">
                            ${
                                map.author
                                    ?.map(authorId => {
                                        const author = authorsData[authorId];
                                        return `<a href="${author?.link}" style="color: ${author?.color}">${truncateAuthorName(author?.name)}</a>`;
                                    })
                                    .join("")
                            }
                            </div>
                        </div>
                        <div class="download-row">
                            <p>${map.provinces}</p>
                            <img src="../../img/library/world.svg" class="download-info-ico" />
                        </div>
                    </div>
                    <div class="download-row-big">
                        <div class="download-row">
                            <img src="../../img/library/mass.svg" class="download-info-ico" />
                            <p>${mapLoads[map.load]}</p>
                        </div>
                        <div class="download-row">
                            <p>${mapTypes[map.type] || map.type}</p>
                            <img src="../../img/library/world.svg" class="download-info-ico" />
                        </div>
                    </div>
                    <div class="download-row-big">
                        <p class="card-description">${map.description}</p>
                    </div>
                    <div class="card-features">
                        ${map.features.map(feature => `<span class="feature-tag">${mapFeatures[feature] || feature}</span>`).join(', ')}
                    </div>
                </div>
            </div>
            <div class="download-down">
                <div class="download-row-big">
                    <div class="card-regions">
                        ${map.region.map(reg => `<span class="region-tag">${mapRegions[reg] || reg}</span>`).join('')}
                    </div>
                </div>
                <div class="download-row-big">
                    <div class="download-row">
                            <img src="../../img/library/calendar.svg" class="download-info-ico" />
                        <p title="Last Update">${new Date(map.lastUpdate).toLocaleDateString()}</p>
                    </div>
                    <div style="display:flex;flex-direction:column;align-items:bottom">
                        ${noRights}
                        <button class="download-download-button" onclick="downloadMapMap('${map.id.join('_')}')" style="background-color: #44944A; border-radius: 15px; width: 45px; height: 45px; border: none; cursor: pointer;">
                            <img src="../../img/library/download.svg" class="download-info-ico" />
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Функция для отображения карт с фильтрацией
function displayMaps(filters = {}) {
    const container = document.getElementById('map-cards');
    if (!container) {
        console.error('Map cards container not found');
        return;
    }

    let filteredMaps = mapsData;

    // Применяем фильтры
    if (filters.type) {
        filteredMaps = filteredMaps.filter(map => map.type === filters.type);
    }
    if (filters.author) {
        filteredMaps = filteredMaps.filter(map => authorsData[map.author]?.name.toLowerCase().includes(filters.author.toLowerCase()));
    }
    if (filters.search) {
        const searchLower = filters.search.toLowerCase();
        filteredMaps = filteredMaps.filter(map => 
            map.title.toLowerCase().includes(searchLower) ||
            map.description.toLowerCase().includes(searchLower)
        );
    }
    if (filters.minProvinces) {
        filteredMaps = filteredMaps.filter(map => map.provinces >= filters.minProvinces);
    }
    if (filters.regions && filters.regions.length > 0) {
        filteredMaps = filteredMaps.filter(map => 
            filters.regions.some(region => map.region.includes(region))
        );
    }
    if (filters.load) {
        filteredMaps = filteredMaps.filter(map => map.load === filters.load);
    }
    if (filters.features && filters.features.length > 0) {
        filteredMaps = filteredMaps.filter(map => 
            filters.features.every(feature => map.features.includes(feature))
        );
    }

    // Сортируем карты
    filteredMaps.sort((a, b) => b.hiddenScore - a.hiddenScore);

    // Отображаем карты
    container.innerHTML = filteredMaps.map(generateMapCard).join('');
}

// Функция для загрузки карты
async function downloadMapMap(mapId) {
    console.log(`Downloading map: ${mapId}`);
    const [author, map, version] = mapId.split('_');
    
    try {
        const fileName = `${mapId}_!.map`;
        const url = `${libLink}lib/${author}/${map}/${fileName}`;
        
        await downloadFile(url, fileName);
        downloadedMaps.add(mapId);
        console.log(`Map ${mapId} downloaded successfully`);
    } catch (error) {
        console.error(`Error downloading map ${mapId}:`, error);
        showErrorMapModal(mapId);
    }
}

// Обновляем функцию applyMapFilters чтобы использовать новые фильтры
function applyMapFilters() {
    const searchText = document.getElementById('map-lib-search').value.toLowerCase();
    const authorFilter = document.getElementById('map-lib-author-filter').value.toLowerCase();
    const typeFilter = document.getElementById('map-lib-type-filter').value;
    const loadFilter = document.getElementById('map-lib-load-filter').value;
    
    // Получаем выбранные регионы
    const selectedRegions = Array.from(document.querySelectorAll('input[name="regions"]:checked'))
        .map(cb => cb.value);
    
    // Получаем выбранные особенности
    const selectedFeatures = Array.from(document.querySelectorAll('input[name="features"]:checked'))
        .map(cb => cb.value);
    
    // Получаем минимальное количество провинций
    const provinceFilters = Array.from(document.querySelectorAll('input[name="provinces"]:checked'))
        .map(v => parseInt(v))
        .sort((a, b) => b - a);
    const minProvinces = provinceFilters[0] || 0;

    // Создаем объект с фильтрами
    const filters = {
        search: searchText,
        author: authorFilter,
        type: typeFilter,
        load: loadFilter,
        regions: selectedRegions,
        features: selectedFeatures,
        minProvinces: minProvinces
    };

    // Применяем фильтры
    displayMaps(filters);
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
    // Создаем контейнер для карт, если его нет
    const mapsDiv = document.querySelector('#maps .download-container');
    if (!mapsDiv.querySelector('#map-cards')) {
        const cardsContainer = document.createElement('div');
        cardsContainer.id = 'map-cards';
        cardsContainer.className = 'download-cards';
        mapsDiv.appendChild(cardsContainer);
    }

    // Отображаем карты
    displayMaps();
});

function getMapData(map) {
    const mapInfo = mapsData.find(m => m.id.join('_') === map);
    if (!mapInfo) {
        console.error(`Map with ID ${map} not found`);
        return null;
    }
    return mapInfo;
}